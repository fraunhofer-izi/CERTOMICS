Bootstrap: docker
From: debian:bookworm-slim

%labels
    Author David Schmidt
    Version v1.0.0

%environment
    export PATH="/usr/local/bin:$PATH"

%post
    DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get install -y --no-install-recommends bash procps wget bowtie2 ca-certificates
    apt-get clean

    mkdir /fastq_screen && cd /fastq_screen
    wget -q https://github.com/StevenWingett/FastQ-Screen/archive/refs/tags/v0.15.3.tar.gz
    tar -xzf v0.15.3.tar.gz --strip-components=1
    rm v0.15.3.tar.gz

    ln -s /fastq_screen/fastq_screen /usr/local/bin/fastq_screen

%test
    # testing for fastq_screen and bowtie2
    command -v fastq_screen >/dev/null || { echo "fastq_screen is missing"; exit 1; }
    command -v bowtie2 >/dev/null || { echo "bowtie2 is missing"; exit 1; }

    # testing for tools required by Nextflow
    command -v awk   >/dev/null || { echo "awk is missing"; exit 1; }
    command -v date  >/dev/null || { echo "date is missing"; exit 1; }
    command -v grep  >/dev/null || { echo "grep is missing"; exit 1; }
    command -v ps    >/dev/null || { echo "ps is missing"; exit 1; }
    command -v sed   >/dev/null || { echo "sed is missing"; exit 1; }
    command -v tail  >/dev/null || { echo "tail is missing"; exit 1; }
    command -v tee   >/dev/null || { echo "tee is missing"; exit 1; }

    # testing for bash (path and version)
    command -v bash  >/dev/null || { echo "bash is missing"; exit 1; }
    BASH_VERSION=$(bash --version | head -n 1 | awk '{print $4}' | cut -d. -f1)
    [ "$BASH_VERSION" -gt 3 ]  || { echo "bash version $BASH_VERSION is too old. Expecting 3.x or later"; exit 1; }
    [ -x /bin/bash ]           || { echo "bash is not in /bin/bash or /usr/bin/bash"; exit 1; }

